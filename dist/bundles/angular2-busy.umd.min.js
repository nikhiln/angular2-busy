!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs/Subscription"),require("@angular/common"),require("angular2-dynamic-component/index")):"function"==typeof define&&define.amd?define(["exports","@angular/core","rxjs/Subscription","@angular/common","angular2-dynamic-component/index"],e):e((t.ng2=t.ng2||{},t.ng2.busy=t.ng2.busy||{}),t.ng.core,t.Rx.Subscription,t.ng.common,t["angular2-dynamic-component/index"])}(this,function(t,e,n,i,r){"use strict";function o(t){return"[object Date]"===Object.prototype.toString.call(t)}function s(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function a(t){return t&&t.window===t}function c(t){return"function"==typeof t}function u(t){return"undefined"!=typeof t}function p(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t!==t&&e!==e)return!0;var n,i,r,d=typeof t,f=typeof e;if(d===f&&"object"===d){if(!Array.isArray(t)){if(o(t))return!!o(e)&&p(t.getTime(),e.getTime());if(s(t))return!!s(e)&&t.toString()===e.toString();if(a(t)||a(e)||Array.isArray(e)||o(e)||s(e))return!1;r=Object.create(null);for(i in t)if("$"!==i.charAt(0)&&!c(t[i])){if(!p(t[i],e[i]))return!1;r[i]=!0}for(i in e)if(!(i in r)&&"$"!==i.charAt(0)&&u(e[i])&&!c(e[i]))return!1;return!0}if(!Array.isArray(e))return!1;if((n=t.length)===e.length){for(i=0;i<n;i++)if(!p(t[i],e[i]))return!1;return!0}}return!1}var d=function(){function t(){this.promiseList=[],this.delayJustFinished=!1}return t.prototype.reset=function(t){var e=this;this.minDuration=t.minDuration,this.promiseList=[],t.promiseList.forEach(function(t){t&&!t.busyFulfilled&&e.addPromise(t)}),0!==this.promiseList.length&&(this.delayJustFinished=!1,t.delay&&(this.delayPromise=setTimeout(function(){e.delayPromise=null,e.delayJustFinished=!0},t.delay)),t.minDuration&&(this.durationPromise=setTimeout(function(){e.durationPromise=null},t.minDuration+(t.delay||0))))},t.prototype.addPromise=function(t){var e=this;this.promiseList.indexOf(t)===-1&&(this.promiseList.push(t),t instanceof Promise?t.then.call(t,function(){return e.finishPromise(t)},function(){return e.finishPromise(t)}):t instanceof n.Subscription&&t.add(function(){return e.finishPromise(t)}))},t.prototype.finishPromise=function(t){t.busyFulfilled=!0;var e=this.promiseList.indexOf(t);e!==-1&&this.promiseList.splice(e,1)},t.prototype.isActive=function(){return!this.delayPromise&&(this.delayJustFinished?(this.delayJustFinished=!1,0===this.promiseList.length&&(this.durationPromise=null),this.promiseList.length>0):!!this.durationPromise||this.promiseList.length>0)},t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[]},t}(),f=function(){function t(t){void 0===t&&(t={});for(var e in l)this[e]=null!=t[e]?t[e]:l[e]}return t}(),l={template:'\n        <div class="ng-busy-default-wrapper">\n            <div class="ng-busy-default-sign">\n                <div class="ng-busy-default-spinner">\n                    <div class="bar1"></div>\n                    <div class="bar2"></div>\n                    <div class="bar3"></div>\n                    <div class="bar4"></div>\n                    <div class="bar5"></div>\n                    <div class="bar6"></div>\n                    <div class="bar7"></div>\n                    <div class="bar8"></div>\n                    <div class="bar9"></div>\n                    <div class="bar10"></div>\n                    <div class="bar11"></div>\n                    <div class="bar12"></div>\n                </div>\n                <div class="ng-busy-default-text">{{message}}</div>\n            </div>\n        </div>\n    ',delay:0,minDuration:0,backdrop:!0,message:"Please wait...",wrapperClass:"ng-busy"},y=function(){function t(t){this.config=t||new f}return t.decorators=[{type:e.Injectable}],t.ctorParameters=function(){return[{type:f,decorators:[{type:e.Optional}]}]},t}(),m=e.style({opacity:0,transform:"translateY(-40px)"}),h=".3s ease",v=function(){function t(t){this.tracker=t,this.context={message:""}}return t.prototype.isActive=function(){return this.tracker.isActive()},t.decorators=[{type:e.Component,args:[{selector:"ng-busy",template:'\n        <div [class]="wrapperClass" *ngIf="isActive()" @flyInOut>\n            <DynamicComponent [componentTemplate]="template" [componentContext]="context">\n            </DynamicComponent>\n        </div>\n    ',animations:[e.trigger("flyInOut",[e.transition("void => *",[m,e.animate(h)]),e.transition("* => void",[e.animate(h,m)])])]}]}],t.ctorParameters=function(){return[{type:d}]},t}(),b=e.style({opacity:0}),g=".3s ease",C=function(){function t(t){this.tracker=t}return t.prototype.isActive=function(){return this.tracker.isActive()},t.decorators=[{type:e.Component,args:[{selector:"ng-busy-backdrop",template:'\n        <div class="ng-busy-backdrop"\n             @fadeInOut\n             *ngIf="isActive()">\n        </div>\n    ',animations:[e.trigger("fadeInOut",[e.transition("void => *",[b,e.animate(g)]),e.transition("* => void",[e.animate(g,b)])])]}]}],t.ctorParameters=function(){return[{type:d}]},t}(),P=function(){function t(t,e,n,i,r){this.service=t,this.tracker=e,this.cfResolver=n,this.vcRef=i,this.injector=r}return t.prototype.normalizeOptions=function(t){return t?(Array.isArray(t)||t instanceof Promise||t instanceof n.Subscription)&&(t={busy:t}):t={busy:null},t=Object.assign({},this.service.config,t),Array.isArray(t.busy)||(t.busy=[t.busy]),t},t.prototype.dectectOptionsChange=function(){return!p(this.optionsNorm,this.optionsRecord)&&(this.optionsRecord=this.optionsNorm,!0)},t.prototype.ngDoCheck=function(){var t=this.optionsNorm=this.normalizeOptions(this.options);this.dectectOptionsChange()&&(this.busyRef&&(this.busyRef.instance.context.message=t.message),!p(t.busy,this.tracker.promiseList)&&this.tracker.reset({promiseList:t.busy,delay:t.delay,minDuration:t.minDuration}),this.busyRef&&this.template===t.template&&this.backdrop===t.backdrop||(this.destroyComponents(),this.template=t.template,this.backdrop=t.backdrop,t.backdrop&&this.createBackdrop(),this.createBusy()))},t.prototype.ngOnDestroy=function(){this.destroyComponents()},t.prototype.destroyComponents=function(){this.busyRef&&this.busyRef.destroy(),this.backdropRef&&this.backdropRef.destroy()},t.prototype.createBackdrop=function(){var t=this.cfResolver.resolveComponentFactory(C);this.backdropRef=this.vcRef.createComponent(t,void 0,this.injector)},t.prototype.createBusy=function(){var t=this.cfResolver.resolveComponentFactory(v);this.busyRef=this.vcRef.createComponent(t,void 0,this.injector);var e=this.optionsNorm,n=e.message,i=e.wrapperClass,r=e.template,o=this.busyRef.instance;o.context.message=n,o.wrapperClass=i,o.template=r},t.decorators=[{type:e.Directive,args:[{selector:"[ngBusy]",providers:[d]}]}],t.ctorParameters=function(){return[{type:y},{type:d},{type:e.ComponentFactoryResolver},{type:e.ViewContainerRef},{type:e.Injector}]},t.propDecorators={options:[{type:e.Input,args:["ngBusy"]}]},t}(),R=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:f,useValue:e}]}},t.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule,r.DynamicComponentModule],declarations:[P,v,C],providers:[y],exports:[P],entryComponents:[v,C]}]}],t.ctorParameters=function(){return[]},t}();t.BusyDirective=P,t.BusyService=y,t.BusyConfig=f,t.BUSY_CONFIG_DEFAULTS=l,t.BusyModule=R,Object.defineProperty(t,"__esModule",{value:!0})});